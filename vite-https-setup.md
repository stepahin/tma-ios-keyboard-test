# Настройка HTTPS для Vite в Telegram Mini App

Данная инструкция описывает, как настроить локальный сервер разработки Vite с поддержкой HTTPS и самоподписанными сертификатами для Telegram Mini App.

## Необходимые зависимости

Установите необходимые зависимости для работы с HTTPS:

```bash
npm install --save-dev vite-plugin-mkcert
```

## Конфигурация Vite

Настройте файл `vite.config.ts` следующим образом:

```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'
import mkcert from 'vite-plugin-mkcert'

export default defineConfig({
  plugins: [react(), mkcert()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  server: {
    https: {
      key: './[ваш-ip-адрес]+1-key.pem',
      cert: './[ваш-ip-адрес]+1.pem',
    },
    host: true,
    port: 3030,
  },
})
```

## Генерация сертификатов

Сертификаты генерируются автоматически при первом запуске сервера с плагином `mkcert`. Плагин создаст файлы с именем, соответствующим вашему IP-адресу, например:
- `192.168.8.114+1-key.pem` - приватный ключ
- `192.168.8.114+1.pem` - сертификат

## Процесс работы

1. При первом запуске Vite с плагином `mkcert()`, он автоматически установит локальный центр сертификации (CA) и создаст самоподписанные сертификаты для вашего локального IP-адреса.

2. После генерации сертификатов, вам нужно указать пути к файлам сертификатов в конфигурации `server.https`.

3. Сертификаты будут использоваться для HTTPS соединения на указанном порту (3030).

## Запуск сервера

Для запуска сервера используйте стандартную команду:

```bash
npm run dev
```

После запуска, ваше приложение будет доступно по адресу `https://localhost:3030` или `https://[ваш-ip-адрес]:3030`.

## Важные замечания

1. **Для Telegram Mini App**: Убедитесь, что вы всегда используете порт 3030, так как он указан в настройках бота и туннеля для тестового доступа.

2. **Перед каждым запуском**: Убедитесь, что нет других процессов, использующих порт 3030. Для остановки предыдущих процессов можно использовать команды:
   ```bash
   # Для Mac/Linux
   lsof -i :3030 | grep LISTEN
   kill -9 [PID]
   
   # Для Windows
   netstat -ano | findstr :3030
   taskkill /F /PID [PID]
   ```

3. **Доверие сертификатам**: При первом запуске браузер может показать предупреждение о недоверенном сертификате. Вам нужно будет добавить исключение для этого сертификата в вашем браузере.
